# Чек-лист для ручного тестирования Feed функциональности

## Подготовка к тестированию

### 1. Запуск окружения
- [ ] Backend запущен локально (`npm run start:dev`)
- [ ] Docker инфраструктура поднята (PostgreSQL, MinIO, Redis)
- [ ] Frontend запущен на Web (`flutter run -d chrome`)
- [ ] Chrome DevTools открыт (F12) → Network tab

### 2. Установка зависимостей
- [ ] Выполнен `flutter pub get` в `frontend/`
- [ ] Пакет `share_plus: ^7.2.1` установлен
- [ ] Нет ошибок компиляции (`flutter analyze`)

---

## 1. Тестирование загрузки медиа (Web + Mobile)

### Форматы и размеры
- [ ] **Маленькое фото (PNG < 100KB)**
  - Выбрать маленькое PNG изображение
  - Проверить предпросмотр в `CreatePostScreen`
  - Загрузить пост
  - Убедиться, что фото отображается в ленте и деталях поста
  - **DevTools:** Проверить, что в `multipart/form-data` есть `Content-Disposition: form-data; name="file"; filename="something.png"`

- [ ] **Большое фото (JPEG 5MB+)**
  - Выбрать большое JPEG изображение (> 5MB)
  - Проверить, что `AppImagePreview` показывает индикатор загрузки
  - Загрузить пост
  - Убедиться, что загрузка завершается успешно
  - **DevTools:** Проверить размер payload в Network tab

### Множественный выбор
- [ ] Выбрать 3-5 фото одновременно
- [ ] Проверить, что все фото отображаются в гриде выбранных медиа
- [ ] Прокрутить список выбранных фото
- [ ] Убедиться, что `AppImagePreview` не "моргает" при прокрутке
- [ ] Удалить одно фото из середины списка
- [ ] Проверить, что индексы не сбились (остальные фото на своих местах)

### Очистка и повторное добавление
- [ ] Добавить фото в список
- [ ] Удалить его из списка
- [ ] Добавить снова
- [ ] Убедиться, что фото отображается корректно
- [ ] Проверить, что при загрузке все фото отправляются на сервер

### Проверка filename в запросе
- [ ] Открыть DevTools → Network
- [ ] Выбрать запрос `POST /api/v2/upload/post`
- [ ] Проверить Request Payload → Form Data
- [ ] Убедиться, что у файла есть поле `filename` с расширением (например, `filename="image.jpg"`)
- [ ] Проверить, что бэкенд принимает файл (статус 200/201)

---

## 2. Тестирование Лайков (Стресс-тест)

### "Double Tap" тест
- [ ] Открыть `PostDetailScreen` для любого поста
- [ ] Быстро кликнуть на лайк 2-3 раза подряд
- [ ] **Ожидание:** Кнопка должна игнорировать лишние нажатия благодаря `_isLiking`
- [ ] Счетчик должен измениться строго один раз (не "дергаться")
- [ ] Иконка должна стать красной один раз

### Тест на ошибку (Network Throttling)
- [ ] Открыть DevTools → Network → Throttling → "Fast 3G"
- [ ] Или временно отключить интернет
- [ ] Нажать лайк на посте
- [ ] **Ожидание:**
  1. Сердце краснеет сразу (оптимистичное обновление)
  2. Через несколько секунд возвращается в серый цвет (откат)
  3. Появляется SnackBar с ошибкой
- [ ] Включить интернет обратно
- [ ] Нажать лайк снова
- [ ] Убедиться, что лайк работает корректно

### Обновление списка
- [ ] Открыть `FeedScreen` (лента постов)
- [ ] Запомнить состояние лайка у одного поста (лайкнут/не лайкнут)
- [ ] Открыть этот пост в `PostDetailScreen`
- [ ] Изменить состояние лайка (лайкнуть/анлайкнуть)
- [ ] Вернуться назад в `FeedScreen`
- [ ] Проверить, обновился ли лайк в ленте
- [ ] **Примечание:** Зависит от того, используют ли они один и тот же провайдер

### Проверка оптимистичного UI
- [ ] Открыть `PostDetailScreen`
- [ ] Запомнить текущий счетчик лайков
- [ ] Нажать лайк
- [ ] **Ожидание:** Счетчик должен измениться мгновенно (до ответа сервера)
- [ ] Проверить в DevTools → Network, что запрос уходит в фоне
- [ ] После успешного ответа счетчик должен остаться корректным

---

## 3. Тестирование Share (Cross-platform)

### Десктопный браузер (Chrome)
- [ ] Открыть `PostDetailScreen` для любого поста
- [ ] Нажать кнопку "Поделиться"
- [ ] **Ожидание:** Скорее всего, сработает fallback (так как десктопный Chrome без HTTPS не поддерживает Share API)
- [ ] Должен появиться SnackBar: "Ссылка скопирована в буфер обмена"
- [ ] Вставить ссылку в адресную строку (Ctrl+V)
- [ ] Проверить, что ссылка корректная (формат: `https://service-platform.com/post/{postId}`)

### Мобильный браузер (если доступно)
- [ ] Запустить приложение на мобильном устройстве или эмуляторе
- [ ] Открыть `PostDetailScreen`
- [ ] Нажать кнопку "Поделиться"
- [ ] **Ожидание:** Должно открыться нативное меню шаринга (iOS/Android)
- [ ] Проверить, что текст поста и ссылка передаются корректно
- [ ] Выбрать приложение для шаринга (например, WhatsApp, Telegram)
- [ ] Убедиться, что сообщение содержит текст поста и ссылку

### Тест fallback на Web
- [ ] Открыть DevTools → Console
- [ ] Нажать "Поделиться"
- [ ] Проверить, что нет ошибок в консоли
- [ ] Убедиться, что fallback срабатывает корректно

---

## 4. Тестирование Аватаров

### Консистентность цвета
- [ ] Найти пользователя без аватара (только инициалы)
- [ ] Запомнить цвет фона аватара
- [ ] Перезагрузить страницу (F5)
- [ ] **Ожидание:** Цвет должен остаться тем же (так как он привязан к хэшу `userId`)
- [ ] Перейти на другой экран и вернуться обратно
- [ ] Проверить, что цвет не изменился

### Инициалы
- [ ] Найти пользователя с именем из одного слова (например, "Admin")
- [ ] Проверить, что отображается одна буква ("A")
- [ ] Найти пользователя с именем из двух слов (например, "Глеб Равинский")
- [ ] Проверить, что отображаются две буквы ("ГР")
- [ ] Найти пользователя без имени (null или пустая строка)
- [ ] Проверить, что отображается "?"

### Отображение фото
- [ ] Найти пользователя с аватаром
- [ ] Проверить, что фото загружается корректно
- [ ] Проверить, что при ошибке загрузки показываются инициалы
- [ ] Проверить placeholder (индикатор загрузки) при загрузке фото

---

## Технический чек-лист (DevTools)

### Network Tab
- [ ] **Payload проверка:**
  - Открыть запрос `POST /api/v2/upload/post`
  - Проверить Request Payload → Form Data
  - Убедиться, что у файла в `Content-Disposition` есть `filename="something.jpg"`
  - Проверить, что `Content-Type` корректный (например, `image/jpeg`)

- [ ] **Throttling тест:**
  - Установить Network → Throttling → "Fast 3G"
  - Протестировать загрузку фото
  - Проверить, что индикатор загрузки не "висит" слишком долго
  - Протестировать лайки с оптимистичным UI
  - Убедиться, что UI обновляется мгновенно, а запрос уходит в фоне

### Console Tab
- [ ] Проверить, что нет ошибок JavaScript/Dart
- [ ] Проверить, что нет предупреждений о deprecated API
- [ ] Убедиться, что логирование работает корректно (если есть)

### Performance Tab (опционально)
- [ ] Проверить время загрузки `AppImagePreview`
- [ ] Убедиться, что нет memory leaks при множественном выборе фото
- [ ] Проверить производительность оптимистичного UI

---

## Критические проверки

### Обязательные тесты перед коммитом:
- [ ] Загрузка фото работает на Web без ошибок
- [ ] Лайки работают с оптимистичным UI и откатом при ошибке
- [ ] Share работает с fallback на Clipboard
- [ ] Аватары отображаются корректно с консистентным цветом
- [ ] Нет ошибок компиляции (`flutter analyze`)
- [ ] Нет runtime ошибок в консоли

### Регрессионные тесты:
- [ ] Создание поста без фото работает как раньше
- [ ] Комментарии работают как раньше
- [ ] Навигация между экранами работает корректно
- [ ] Другие функции приложения не сломались

---

## Известные проблемы и ограничения

### Web Share API
- На десктопном Chrome без HTTPS Share API не работает → всегда используется fallback
- Это ожидаемое поведение, не является багом

### Оптимистичный UI
- При очень быстрых кликах (более 3 раз в секунду) может быть небольшая задержка
- Это нормально благодаря флагу `_isLiking`

### Аватары
- Цвет генерируется на основе хэша `userId`, поэтому одинаковые ID дают одинаковый цвет
- Это ожидаемое поведение для консистентности

---

## Результаты тестирования

**Дата тестирования:** _______________

**Тестировщик:** _______________

**Версия:** _______________

**Результаты:**
- [ ] Все тесты пройдены успешно
- [ ] Обнаружены проблемы (описать ниже)
- [ ] Требуется доработка

**Обнаруженные проблемы:**
1. _________________________________________________
2. _________________________________________________
3. _________________________________________________

**Рекомендации:**
1. _________________________________________________
2. _________________________________________________
3. _________________________________________________
