# ТЕХНИЧЕСКОЕ ЗАДАНИЕ - Платформа Service

**Версия:** 1.0
**Дата:** Декабрь 2025

---

## 1. Общие сведения

**Service** — платформа для поиска и бронирования услуг мастеров различных специальностей. Объединяет функции маркетплейса услуг и социальной сети с визуальным контентом.

### 1.1 Цели проекта

1. Создать удобную платформу для поиска мастеров по геолокации
2. Обеспечить визуальный выбор через портфолио и короткие видео
3. Автоматизировать бронирование и управление расписанием
4. Создать доверительную среду через отзывы и верификацию

### 1.2 Границы проекта

**В рамках MVP:**
- Регистрация и профили пользователей
- Каталог услуг и поиск мастеров
- Бронирование и управление расписанием
- Лента контента и социальные функции
- Базовый чат и уведомления

**Вне рамок MVP (v1.0+):**
- Оплата через платформу
- Видеоредактор
- CRM для мастеров
- Расширенная аналитика

---

## 2. Технический стек

### 2.1 Frontend

**Фреймворк:** Flutter 3.x
- **Платформы:** iOS, Android, Web
- **Единая кодовая база**
- **State Management:** BLoC / Riverpod / Provider (выбор на этапе проектирования)
- **Карты:** Google Maps API / Mapbox
- **UI Kit:** Material Design 3 с кастомными компонентами

**Основные библиотеки:**
- `flutter_bloc` / `riverpod` - State Management
- `dio` - HTTP клиент
- `get_it` - Dependency Injection
- `freezed` - Code generation для моделей
- `google_maps_flutter` / `mapbox_gl` - Карты
- `image_picker` - Работа с фото/видео
- `video_player` - Проигрывание видео
- `firebase_messaging` - Push уведомления
- `web_socket_channel` - WebSocket

### 2.2 Backend

**Основные варианты (выбор один из):**

#### Вариант 1: Node.js + NestJS
- **Язык:** TypeScript
- **Фреймворк:** NestJS
- **ORM:** Prisma / TypeORM
- **Валидация:** class-validator

#### Вариант 2: Go + Fiber
- **Язык:** Go 1.21+
- **Фреймворк:** Fiber / Gin
- **ORM:** GORM
- **Производительность:** Высокая

#### Вариант 3: Python + FastAPI
- **Язык:** Python 3.11+
- **Фреймворк:** FastAPI
- **ORM:** SQLAlchemy / Tortoise ORM
- **Async:** Full async support

**Рекомендация:** Node.js + NestJS (для быстрого старта и большой экосистемы)

### 2.3 База данных

**Основная БД:** PostgreSQL 15+
- Реляционная модель данных
- PostGIS расширение для геолокации
- JSONB для гибких данных
- Full-text search

**Кэш:** Redis 7+
- Кэширование часто запрашиваемых данных
- Rate limiting
- Сессии пользователей
- Real-time данные

**Поиск:** Meilisearch / Elasticsearch
- Полнотекстовый поиск
- Автодополнение
- Фильтрация и фасеты
- Высокая скорость

### 2.4 Хранилище файлов

**S3-совместимое:** MinIO / AWS S3
- Хранение изображений
- Хранение видео (15 сек)
- Хранение документов
- CDN для быстрой загрузки

### 2.5 Real-time коммуникации

**WebSocket:**
- Socket.IO / ws (Node.js)
- Gorilla WebSocket (Go)
- FastAPI WebSockets (Python)

**Функции:**
- Чат в реальном времени
- Уведомления
- Статусы онлайн
- Индикатор набора текста

### 2.6 Уведомления

**Push:** Firebase Cloud Messaging (FCM)
- iOS push
- Android push
- Web push

**Email:** SendGrid / AWS SES
- Транзакционные письма
- Напоминания
- Маркетинг (опционально)

### 2.7 Инфраструктура

**MVP развёртывание:**
- Локальный Linux-сервер / VPS
- Docker + Docker Compose
- Nginx как reverse proxy
- Certbot для SSL

**Production (будущее):**
- AWS / GCP / Azure
- Kubernetes для оркестрации
- Load balancing
- Auto-scaling

**CI/CD:**
- GitHub Actions
- Автоматические тесты
- Автоматический деплой

### 2.8 Мониторинг и логирование

**Логи:**
- Winston (Node.js) / Zap (Go) / Loguru (Python)
- Централизованное логирование

**Мониторинг:**
- Prometheus + Grafana (будущее)
- Базовый health check

**Ошибки:**
- Sentry для отслеживания ошибок

---

## 3. Модули системы

### 3.1 Auth (Аутентификация)
- Регистрация по email/телефону
- OAuth (Google, Apple)
- JWT токены (access + refresh)
- Верификация email/телефона
- Восстановление пароля
- Rate limiting

### 3.2 Users (Пользователи)
- Профили клиентов
- Профили мастеров
- Настройки аккаунта
- Геолокация
- Рейтинги и счётчики

### 3.3 Catalog (Каталог)
- Дерево категорий
- Локализация
- Управление через админ-панель
- Предложения новых категорий

### 3.4 Search (Поиск)
- Полнотекстовый поиск
- Гео-поиск (радиус, карта)
- Фильтры (цена, рейтинг, категория)
- Сортировка
- Автодополнение

### 3.5 Booking (Бронирование)
- Расписание мастера
- Слоты и исключения
- Интеграция с Google Calendar
- Жизненный цикл записи (pending → confirmed → completed)
- Отмены и переносы
- No-show tracking

### 3.6 Content (Контент)
- Посты мастеров (фото/видео)
- Лента (рекомендации/подписки/рядом)
- Загрузка медиа
- Обработка видео (конвертация, thumbnails)
- Stories (бэклог)

### 3.7 Social (Социальные функции)
- Подписки
- Лайки
- Комментарии
- Шеринг
- Реферальная программа

### 3.8 Chat (Чат)
- Текстовые сообщения
- Прикрепление фото/файлов
- WebSocket для real-time
- История сообщений
- Переводчик (v1.0)

### 3.9 Notifications (Уведомления)
- Push уведомления
- Email уведомления
- Напоминания о записи
- Настройки уведомлений

### 3.10 Payment (Платежи) - v1.0
- Интеграция платёжных шлюзов
- Комиссия платформы
- Вывод средств
- История транзакций

### 3.11 Admin (Админ-панель)
- Дашборд с метриками
- Управление каталогом
- Модерация контента
- Управление пользователями
- Техподдержка

---

## 4. Функциональные требования MVP

### 4.1 Аутентификация
- ✅ Регистрация по email/телефону
- ✅ OAuth (Google, Apple)
- ✅ JWT токены
- ✅ Верификация
- ✅ Восстановление пароля

### 4.2 Профили
- ✅ Профиль клиента и мастера
- ✅ Переключение роли
- ✅ Портфолио (фото, видео 15 сек)
- ✅ Рейтинг и счётчики

### 4.3 Каталог и поиск
- ✅ Многоуровневый каталог
- ✅ Полнотекстовый и гео-поиск
- ✅ Фильтры и сортировка
- ✅ Карта с маркерами

### 4.4 Бронирование
- ✅ Расписание мастера
- ✅ Интеграция с Google Calendar
- ✅ Автослоты
- ✅ Статусы (pending → confirmed → completed)
- ✅ Отмена, перенос

### 4.5 Контент
- ✅ Публикация фото/видео
- ✅ Лента (рекомендации/подписки/рядом)
- ✅ Лайки и комментарии
- ✅ Подписки

### 4.6 Коммуникации
- ✅ Чат (текст + фото)
- ✅ Push-уведомления
- ✅ Напоминания о записи

### 4.7 Монетизация
- ✅ Премиум клиента (скидка 5%, без рекламы)
- ✅ Премиум мастера (приоритет)
- ✅ Реферальная программа
- ✅ Внешняя реклама (Google Ads, Yandex)

---

## 5. Нефункциональные требования

### 5.1 Производительность

- **API Response Time:** < 200ms (95 percentile)
- **Поиск:** < 100ms
- **Загрузка ленты:** < 300ms
- **Одновременных пользователей:** 1000+ (MVP)
- **RPS:** 100+ запросов в секунду

### 5.2 Масштабируемость

**MVP:**
- 1000 пользователей
- 100+ мастеров
- Локальный сервер

**Будущее:**
- Горизонтальное масштабирование
- Микросервисная архитектура (опционально)
- CDN для статики
- Database replication

### 5.3 Безопасность

- **HTTPS** обязательно
- **Хэширование паролей:** bcrypt
- **JWT токены** с коротким временем жизни
- **Rate limiting:** 100 req/min
- **SQL Injection protection:** Prepared statements
- **XSS protection:** Sanitization
- **GDPR compliance:** Удаление данных по запросу
- **Контакты скрыты** до подтверждения записи

### 5.4 Доступность

- **Uptime:** 99% (MVP), 99.9% (Production)
- **Резервное копирование:** Ежедневно
- **Recovery Time:** < 4 часов

### 5.5 Локализация

- Мультиязычный интерфейс
- Автоопределение языка
- Ручной выбор языка
- Локализованный каталог
- Поддержка RTL (в будущем)

### 5.6 Совместимость

**Mobile:**
- iOS 13+
- Android 8+

**Web:**
- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+

---

## 6. Архитектура

### 6.1 Высокоуровневая архитектура

```
┌─────────────┐
│   Flutter   │  iOS, Android, Web
│   Frontend  │
└──────┬──────┘
       │ HTTPS / WebSocket
       ↓
┌─────────────────┐
│   API Gateway   │  Nginx
│   + Load Balancer│
└──────┬──────────┘
       │
       ↓
┌─────────────────┐
│   Backend API   │  NestJS / Go / FastAPI
│   (REST + WS)   │
└──────┬──────────┘
       │
    ┌──┴──┬───────────┬──────────┬────────┐
    ↓     ↓           ↓          ↓        ↓
┌────────┐ ┌────────┐ ┌────────┐ ┌──────┐ ┌────────┐
│PostGre │ │ Redis  │ │Meili   │ │MinIO │ │Firebase│
│  SQL   │ │ Cache  │ │search  │ │ S3   │ │  FCM   │
└────────┘ └────────┘ └────────┘ └──────┘ └────────┘
```

### 6.2 Слои приложения

**Frontend (Flutter):**
- Presentation Layer (UI)
- Business Logic (BLoC/Riverpod)
- Data Layer (Repositories, API clients)

**Backend:**
- Controller Layer (HTTP handlers)
- Service Layer (Business logic)
- Repository Layer (Data access)
- Database Layer (PostgreSQL, Redis)

### 6.3 Паттерны проектирования

- **Repository Pattern** для доступа к данным
- **Dependency Injection** для loose coupling
- **Factory Pattern** для создания объектов
- **Observer Pattern** для уведомлений
- **Strategy Pattern** для алгоритмов поиска

---

## 7. Этапы разработки

| # | Содержание | Результат | Срок |
|---|------------|-----------|------|
| 1 | Проектирование: БД, API, UI/UX | Документация, прототипы | 2-3 нед |
| 2 | Backend: Auth, Users, Catalog, Search | API v0.1 | 3-4 нед |
| 3 | Backend: Booking, Content, Chat | API v0.2 | 3-4 нед |
| 4 | Flutter: Auth, Profiles, Search, Map | App v0.1 | 4-5 нед |
| 5 | Flutter: Booking, Feed, Chat | App v0.2 | 4-5 нед |
| 6 | Тестирование, деплой, оптимизация | MVP Launch | 3-4 нед |

**Общая оценка MVP:** 4-5 месяцев

---

## 8. Критерии приёмки MVP

### 8.1 Функциональность

- ✅ Регистрация и авторизация работают на всех платформах
- ✅ Поиск мастеров по категории и геолокации
- ✅ Просмотр профиля и портфолио мастера
- ✅ Бронирование услуги с подтверждением
- ✅ Чат между клиентом и мастером
- ✅ Лента постов с лайками и комментариями
- ✅ Push-уведомления работают
- ✅ Оформление премиум-подписки

### 8.2 Производительность

- ✅ API < 200ms
- ✅ Поддержка 1000 пользователей
- ✅ Без критических багов

### 8.3 Безопасность

- ✅ HTTPS
- ✅ Защита от SQL injection
- ✅ Rate limiting
- ✅ Безопасное хранение паролей

### 8.4 UX

- ✅ Интуитивный интерфейс
- ✅ Быстрая навигация
- ✅ Адаптивный дизайн (mobile, web)

---

## 9. Риски и митигация

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Низкая производительность поиска | Средняя | Высокое | Использование Meilisearch, кэширование, индексы БД |
| Проблемы с геолокацией | Средняя | Среднее | Тщательное тестирование, fallback на ручной ввод |
| Сложность интеграции календарей | Высокая | Среднее | Начать с базового функционала, потом добавить интеграции |
| Модерация контента | Средняя | Высокое | Автоматическая модерация + ручная проверка |
| Масштабирование БД | Низкая | Высокое | Грамотная архитектура, индексы, возможность репликации |

---

## 10. Связанные документы

- [BRD](../business/BRD.md) - Бизнес-требования
- [User Stories](../business/UserStories.md) - Пользовательские истории
- [Database Schema](./Database.md) - Схема базы данных
- [API Specification](./API.md) - API спецификация
- [Roadmap](../analysis/Roadmap.md) - Дорожная карта

---

**Статус:** Утверждён
**Последнее обновление:** Декабрь 2025
