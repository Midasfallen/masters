# INTERNATIONALIZATION (i18n) - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Service

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2025

---

## –û–±–∑–æ—Ä

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Service –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **5 —è–∑—ã–∫–æ–≤** –¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:**
- üá¨üáß **EN** - English (–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- üá∑üá∫ **RU** - –†—É—Å—Å–∫–∏–π (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä—ã–Ω–æ–∫)
- üá©üá™ **DE** - Deutsch (–ï–≤—Ä–æ–ø–∞)
- üá™üá∏ **ES** - Espa√±ol (–ò—Å–ø–∞–Ω–∏—è, –õ–∞—Ç–∏–Ω—Å–∫–∞—è –ê–º–µ—Ä–∏–∫–∞)
- üá´üá∑ **FR** - Fran√ßais (–§—Ä–∞–Ω—Ü–∏—è)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ i18n

### Backend (NestJS)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `nestjs-i18n`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
backend/
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ i18n/
        ‚îú‚îÄ‚îÄ en/
        ‚îÇ   ‚îú‚îÄ‚îÄ catalog.json
        ‚îÇ   ‚îú‚îÄ‚îÄ common.json
        ‚îÇ   ‚îú‚îÄ‚îÄ auth.json
        ‚îÇ   ‚îú‚îÄ‚îÄ booking.json
        ‚îÇ   ‚îú‚îÄ‚îÄ errors.json
        ‚îÇ   ‚îî‚îÄ‚îÄ notifications.json
        ‚îú‚îÄ‚îÄ ru/
        ‚îÇ   ‚îî‚îÄ‚îÄ ... (same structure)
        ‚îú‚îÄ‚îÄ de/
        ‚îÇ   ‚îî‚îÄ‚îÄ ... (same structure)
        ‚îú‚îÄ‚îÄ es/
        ‚îÇ   ‚îî‚îÄ‚îÄ ... (same structure)
        ‚îî‚îÄ‚îÄ fr/
            ‚îî‚îÄ‚îÄ ... (same structure)
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (i18n.module.ts):**
```typescript
import { Module } from '@nestjs/common';
import { I18nModule, AcceptLanguageResolver, QueryResolver, HeaderResolver } from 'nestjs-i18n';
import * as path from 'path';

@Module({
  imports: [
    I18nModule.forRoot({
      fallbackLanguage: 'en',
      loaderOptions: {
        path: path.join(__dirname, '/i18n/'),
        watch: true,
      },
      resolvers: [
        { use: QueryResolver, options: ['lang'] },
        AcceptLanguageResolver,
        new HeaderResolver(['x-lang']),
      ],
    }),
  ],
})
export class I18nConfigModule {}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
```typescript
import { I18nService } from 'nestjs-i18n';

@Injectable()
export class CatalogService {
  constructor(private readonly i18n: I18nService) {}

  async getCategories(lang: string) {
    return {
      id: 1,
      name: await this.i18n.translate('catalog.categories.beauty', { lang }),
      description: await this.i18n.translate('catalog.descriptions.beauty', { lang }),
    };
  }
}
```

---

### Frontend (Flutter)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `flutter_localizations` + `intl` + `easy_localization`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
frontend/
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ l10n/
        ‚îú‚îÄ‚îÄ intl_en.arb
        ‚îú‚îÄ‚îÄ intl_ru.arb
        ‚îú‚îÄ‚îÄ intl_de.arb
        ‚îú‚îÄ‚îÄ intl_es.arb
        ‚îî‚îÄ‚îÄ intl_fr.arb
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (pubspec.yaml):**
```yaml
dependencies:
  flutter_localizations:
    sdk: flutter
  intl: ^0.18.0
  easy_localization: ^3.0.3

flutter:
  generate: true
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (l10n.yaml):**
```yaml
arb-dir: lib/l10n
template-arb-file: intl_en.arb
output-localization-file: app_localizations.dart
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
```dart
import 'package:flutter_gen/gen_l10n/app_localizations.dart';

class CategoryScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final l10n = AppLocalizations.of(context)!;

    return Text(l10n.category_beauty);
  }
}
```

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞

### Backend API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:**
1. **Query –ø–∞—Ä–∞–º–µ—Ç—Ä:** `?lang=en`
2. **HTTP Header:** `Accept-Language: en-US,en;q=0.9`
3. **Custom Header:** `X-Lang: en`
4. **Fallback:** `en` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# Query –ø–∞—Ä–∞–º–µ—Ç—Ä (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
GET /api/catalog/categories?lang=ru

# Accept-Language header
GET /api/catalog/categories
Headers: Accept-Language: fr-FR,fr;q=0.9

# Custom header
GET /api/catalog/categories
Headers: X-Lang: de
```

---

### Frontend App

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **User preference** - —è–∑—ã–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ local storage)
2. **Device locale** - —è–∑—ã–∫ —Å–∏—Å—Ç–µ–º—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. **Fallback:** `en`

**–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞:**
```dart
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
await context.setLocale(Locale('ru'));

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
await SharedPreferences.getInstance().then((prefs) {
  prefs.setString('selected_language', 'ru');
});
```

---

## Translation Files

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON —Ñ–∞–π–ª–æ–≤

**–ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥ (catalog.json):**
```json
{
  "categories": {
    "beauty": "Beauty & Care",
    "health": "Health & Massage",
    "sport": "Sport & Fitness",
    "education": "Education & Tutoring",
    "repair": "Repair & Household",
    "auto": "Auto & Transport",
    "pets": "Pets",
    "events": "Events & Celebrations",
    "creativity": "Creativity & Hobbies",
    "business": "Business Services"
  },
  "subcategories": {
    "hairdressing": "Hair Services",
    "nails": "Nail Services",
    "cosmetology": "Cosmetology",
    ...
  },
  "services": {
    "men_haircut": "Men's Haircut",
    "women_haircut": "Women's Haircut",
    ...
  }
}
```

**–û–±—â–∏–µ —Ñ—Ä–∞–∑—ã (common.json):**
```json
{
  "app_name": "Service",
  "welcome": "Welcome",
  "search": "Search",
  "filter": "Filter",
  "book_now": "Book Now",
  "my_bookings": "My Bookings",
  "profile": "Profile",
  "settings": "Settings",
  "logout": "Log Out"
}
```

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (auth.json):**
```json
{
  "login": "Log In",
  "register": "Sign Up",
  "email": "Email",
  "password": "Password",
  "forgot_password": "Forgot Password?",
  "reset_password": "Reset Password",
  "verify_email": "Verify Email"
}
```

**–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (booking.json):**
```json
{
  "create_booking": "Create Booking",
  "select_service": "Select Service",
  "select_date": "Select Date",
  "select_time": "Select Time",
  "confirm_booking": "Confirm Booking",
  "booking_confirmed": "Booking Confirmed",
  "cancel_booking": "Cancel Booking",
  "reschedule": "Reschedule"
}
```

**–û—à–∏–±–∫–∏ (errors.json):**
```json
{
  "unauthorized": "Unauthorized",
  "invalid_credentials": "Invalid email or password",
  "email_already_exists": "Email already registered",
  "slot_not_available": "This time slot is not available",
  "network_error": "Network error. Please try again."
}
```

**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (notifications.json):**
```json
{
  "new_booking": "New booking from {clientName}",
  "booking_confirmed": "Your booking is confirmed for {date}",
  "booking_cancelled": "Booking cancelled by {userName}",
  "reminder_1h": "Reminder: Booking in 1 hour with {masterName}"
}
```

---

## –ü—Ä–∞–≤–∏–ª–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Keys (–ö–ª—é—á–∏)

**–§–æ—Ä–º–∞—Ç:** `snake_case`

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```json
{
  "men_haircut": "Men's Haircut",
  "booking_confirmed": "Booking Confirmed"
}
```

‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```json
{
  "menHaircut": "Men's Haircut",
  "Booking-Confirmed": "Booking Confirmed"
}
```

---

### 2. Pluralization (–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ)

**NestJS i18n:**
```json
{
  "booking_count": "{count} booking | {count} bookings"
}
```

**Flutter (ARB):**
```json
{
  "bookingCount": "{count, plural, one{1 booking} other{{count} bookings}}"
}
```

---

### 3. Interpolation (–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞)

**NestJS:**
```json
{
  "welcome_user": "Welcome, {name}!"
}
```

**Flutter:**
```json
{
  "welcomeUser": "Welcome, {name}!"
}
```

---

### 4. Gender (–†–æ–¥)

**–î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞:**
```json
{
  "completed_booking": {
    "male": "–ó–∞–≤–µ—Ä—à–∏–ª –∑–∞–ø–∏—Å—å",
    "female": "–ó–∞–≤–µ—Ä—à–∏–ª–∞ –∑–∞–ø–∏—Å—å"
  }
}
```

---

### 5. Date & Time

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- EN: `MM/DD/YYYY` (12/20/2025)
- RU: `DD.MM.YYYY` (20.12.2025)
- DE: `DD.MM.YYYY` (20.12.2025)
- ES: `DD/MM/YYYY` (20/12/2025)
- FR: `DD/MM/YYYY` (20/12/2025)

**–í—Ä–µ–º—è:**
- EN: `12:30 PM` (12-hour)
- RU: `12:30` (24-hour)
- DE: `12:30` (24-hour)
- ES: `12:30` (24-hour)
- FR: `12h30` (24-hour)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
```dart
import 'package:intl/intl.dart';

final formatter = DateFormat.yMd(locale);
final formattedDate = formatter.format(DateTime.now());
```

---

### 6. Currency (–í–∞–ª—é—Ç–∞)

**–ú–∞—Å—Ç–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –≤–∞–ª—é—Ç—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ:**
- USD - $ (Dollar)
- EUR - ‚Ç¨ (Euro)
- RUB - ‚ÇΩ (Ruble)
- GBP - ¬£ (Pound)

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```dart
final formatter = NumberFormat.currency(locale: locale, symbol: currencySymbol);
final price = formatter.format(100); // "$100.00" or "100,00 ‚Ç¨"
```

---

## Workflow –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤

### 1. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –∫–ª—é—á

**Backend (catalog.json):**
```json
{
  "new_service": "New Service"
}
```

**Frontend (intl_en.arb):**
```json
{
  "newService": "New Service"
}
```

---

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥

- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –∫–ª—é—á–∏ –±–µ–∑ –ø–µ—Ä–µ–≤–æ–¥–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞–º (5 —è–∑—ã–∫–æ–≤)
- –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –æ–±—Ä–∞—Ç–Ω–æ

---

### 3. –ò–º–ø–æ—Ä—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤

- –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- –ö–æ–º–º–∏—Ç–∏–º –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

---

### 4. CI/CD –ø—Ä–æ–≤–µ—Ä–∫–∏

**Pre-commit hook:**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —è–∑—ã–∫–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–ª—é—á–∏
npm run i18n:check
```

**Script (package.json):**
```json
{
  "scripts": {
    "i18n:check": "node scripts/check-i18n.js"
  }
}
```

**check-i18n.js:**
```javascript
const fs = require('fs');
const languages = ['en', 'ru', 'de', 'es', 'fr'];

languages.forEach(lang => {
  const catalog = require(`./src/i18n/${lang}/catalog.json`);
  const keys = Object.keys(catalog.categories);
  console.log(`${lang}: ${keys.length} category keys`);
});
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ i18n

### Backend

**Unit test:**
```typescript
import { Test } from '@nestjs/testing';
import { I18nService } from 'nestjs-i18n';

describe('CatalogService i18n', () => {
  it('should return translated category name', async () => {
    const service = moduleRef.get<CatalogService>(CatalogService);
    const result = await service.getCategories('ru');

    expect(result[0].name).toBe('–ö—Ä–∞—Å–æ—Ç–∞ –∏ —É—Ö–æ–¥');
  });
});
```

---

### Frontend

**Widget test:**
```dart
testWidgets('should display category in selected language', (tester) async {
  await tester.pumpWidget(
    EasyLocalization(
      supportedLocales: [Locale('en'), Locale('ru')],
      path: 'lib/l10n',
      fallbackLocale: Locale('en'),
      child: MyApp(),
    ),
  );

  await tester.pumpAndSettle();
  expect(find.text('Beauty & Care'), findsOneWidget);
});
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

**Backend:**
```typescript
@Injectable()
export class CatalogService {
  private translationCache = new Map<string, any>();

  async getCategoriesTranslated(lang: string) {
    const cacheKey = `categories_${lang}`;

    if (this.translationCache.has(cacheKey)) {
      return this.translationCache.get(cacheKey);
    }

    const translated = await this.translateCategories(lang);
    this.translationCache.set(cacheKey, translated);

    return translated;
  }
}
```

---

### Lazy loading

**Flutter:**
```dart
// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫
await context.setLocale(Locale('ru'));

// –û—Å—Ç–∞–ª—å–Ω—ã–µ —è–∑—ã–∫–∏ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
```

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Catalog](../business/Catalog.md) - –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥ (–∏—Å—Ö–æ–¥–Ω—ã–π, RU)
- [TechSpec](./TechSpec.md) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- [API](./API.md) - API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

---

**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥—ë–Ω
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2025
