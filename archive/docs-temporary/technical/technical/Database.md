# –°–•–ï–ú–ê –ë–ê–ó–´ –î–ê–ù–ù–´–• v2.0 - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Service (–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)

**–°–£–ë–î:** PostgreSQL 15+
**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞:** 24 –¥–µ–∫–∞–±—Ä—è 2025

---

## üìä –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π v2.0

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ **—Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º:

### –î–æ–±–∞–≤–ª–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: **+10**
- `posts` - –ø–æ—Å—Ç—ã –º–∞—Å—Ç–µ—Ä–æ–≤
- `post_media` - –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã –ø–æ—Å—Ç–æ–≤
- `post_mentions` - —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `post_services` - —Å–≤—è–∑—å –ø–æ—Å—Ç–æ–≤ —Å —É—Å–ª—É–≥–∞–º–∏
- `likes` - –ª–∞–π–∫–∏ –Ω–∞ –ø–æ—Å—Ç–∞—Ö
- `comments` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
- `friendships` - –¥—Ä—É–∑—å—è (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å)
- `subscriptions_users` - –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `reposts` - —Ä–µ–ø–æ—Å—Ç—ã –ø–æ—Å—Ç–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `notifications` (11 —Ç–∏–ø–æ–≤)

### –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: **3**
- `users` - –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤
- `bookings` - –ø–æ–ª—è –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
- `messages` - –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### –ò—Ç–æ–≥–æ —Ç–∞–±–ª–∏—Ü –≤ –ë–î: **29** (–±—ã–ª–æ 19)

---

## üìë –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

| # | –¢–∞–±–ª–∏—Ü–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---------|-----------|----------|
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** ||||
| 1 | `users` | Core | –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã ‚ö° –û–ë–ù–û–í–õ–ï–ù–û |
| 2 | `master_profiles` | Masters | –ü—Ä–æ—Ñ–∏–ª–∏ –º–∞—Å—Ç–µ—Ä–æ–≤ |
| **–ö–∞—Ç–∞–ª–æ–≥** ||||
| 3 | `categories` | Catalog | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥ (–¥–µ—Ä–µ–≤–æ) |
| 4 | `category_translations` | Catalog | –ü–µ—Ä–µ–≤–æ–¥—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| 5 | `services` | Catalog | –£—Å–ª—É–≥–∏ –º–∞—Å—Ç–µ—Ä–æ–≤ |
| **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –∑–∞–ø–∏—Å–∏** ||||
| 6 | `schedule_slots` | Schedule | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ |
| 7 | `schedule_exceptions` | Schedule | –ò—Å–∫–ª—é—á–µ–Ω–∏—è (–≤—ã—Ö–æ–¥–Ω—ã–µ, –æ—Ç–ø—É—Å–∫) |
| 8 | `bookings` | Bookings | –ó–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚ö° –û–ë–ù–û–í–õ–ï–ù–û |
| 9 | `reviews` | Social | –û—Ç–∑—ã–≤—ã (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ) |
| **–ö–æ–Ω—Ç–µ–Ω—Ç (NEW)** ||||
| 10 | `posts` | Content | üÜï –ü–æ—Å—Ç—ã –º–∞—Å—Ç–µ—Ä–æ–≤ |
| 11 | `post_media` | Content | üÜï –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –ø–æ—Å—Ç–æ–≤ |
| 12 | `post_mentions` | Content | üÜï –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| 13 | `post_services` | Content | üÜï –°–≤—è–∑—å –ø–æ—Å—Ç–æ–≤ —Å —É—Å–ª—É–≥–∞–º–∏ |
| **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (NEW)** ||||
| 14 | `likes` | Social | üÜï –õ–∞–π–∫–∏ –Ω–∞ –ø–æ—Å—Ç–∞—Ö |
| 15 | `comments` | Social | üÜï –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º |
| 16 | `friendships` | Social | üÜï –î—Ä—É–∑—å—è (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è) |
| 17 | `subscriptions_users` | Social | üÜï –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| 18 | `reposts` | Social | üÜï –†–µ–ø–æ—Å—Ç—ã –ø–æ—Å—Ç–æ–≤ |
| 19 | `subscriptions` | Social | –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ (—Å—Ç–∞—Ä–∞—è) |
| 20 | `blacklists` | Social | –ß—ë—Ä–Ω—ã–µ —Å–ø–∏—Å–∫–∏ |
| **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏** ||||
| 21 | `chats` | Communication | –ß–∞—Ç—ã –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| 22 | `messages` | Communication | –°–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö ‚ö° –û–ë–ù–û–í–õ–ï–ù–û |
| 23 | `notifications` | Communication | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (11 —Ç–∏–ø–æ–≤) |
| **–ü—Ä–æ—á–µ–µ** ||||
| 24 | `referrals` | Misc | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ |
| 25 | `auto_booking_settings` | Premium | üÜï –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π |
| 26 | `user_settings` | Core | üÜï –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| 27 | `favorites_masters` | Social | –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –º–∞—Å—Ç–µ—Ä–∞ |
| 28 | `favorites_posts` | Social | üÜï –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã |
| 29 | `geolocation_history` | Analytics | üÜï –ò—Å—Ç–æ—Ä–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ |

---

## üî• –ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã v2.0

### 1. users - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–û–ë–ù–û–í–õ–ï–ù–û)

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `email` | VARCHAR(255) | Email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| `phone` | VARCHAR(20) | –¢–µ–ª–µ—Ñ–æ–Ω |
| `password_hash` | VARCHAR(255) | –•—ç—à –ø–∞—Ä–æ–ª—è |
| `first_name` | VARCHAR(100) | –ò–º—è |
| `last_name` | VARCHAR(100) | –§–∞–º–∏–ª–∏—è |
| `avatar_url` | TEXT | URL –∞–≤–∞—Ç–∞—Ä–∞ |
| **`is_master`** üÜï | **BOOLEAN** | **–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–∞—Å—Ç–µ—Ä–æ–º** |
| **`master_profile_completed`** üÜï | **BOOLEAN** | **–ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –º–∞—Å—Ç–µ—Ä–∞** |
| `is_verified` | BOOLEAN | KYC –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è |
| `is_premium` | BOOLEAN | –ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å |
| `premium_until` | TIMESTAMP | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–µ–º–∏—É–º–∞ |
| `rating` | DECIMAL(3,2) | –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (–∫–∞–∫ –∫–ª–∏–µ–Ω—Ç–∞) |
| `reviews_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤ |
| `cancellations_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–º–µ–Ω |
| `no_shows_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—è–≤–æ–∫ |
| `blacklists_count` | INTEGER | –í —Å–∫–æ–ª—å–∫–∏—Ö –ß–° —Å–æ—Å—Ç–æ–∏—Ç |
| `language` | VARCHAR(5) | –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |
| `timezone` | VARCHAR(50) | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å |
| `last_location_lat` | DECIMAL(10,8) | –ü–æ—Å–ª–µ–¥–Ω—è—è —à–∏—Ä–æ—Ç–∞ |
| `last_location_lng` | DECIMAL(11,8) | –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–æ–ª–≥–æ—Ç–∞ |
| **`posts_count`** üÜï | **INTEGER** | **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤** |
| **`friends_count`** üÜï | **INTEGER** | **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—Ä—É–∑–µ–π** |
| **`followers_count`** üÜï | **INTEGER** | **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤** |
| **`following_count`** üÜï | **INTEGER** | **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å–æ–∫** |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- UNIQUE –Ω–∞ `email`
- UNIQUE –Ω–∞ `phone`
- INDEX –Ω–∞ `is_master`
- GIST –Ω–∞ geography column (PostGIS)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è v2.0:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_master` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é FALSE)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `master_profile_completed` (FALSE –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è 5 —à–∞–≥–æ–≤)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—á–µ—Ç—á–∏–∫–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

---

### 10. posts - –ü–æ—Å—Ç—ã –º–∞—Å—Ç–µ—Ä–æ–≤ (NEW) üÜï

–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–æ—Å—Ç—ã, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –º–∞—Å—Ç–µ—Ä–∞–º–∏ –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `author_id` FK | UUID | –ê–≤—Ç–æ—Ä –ø–æ—Å—Ç–∞ ‚Üí users.id |
| `description` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤) |
| `media_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ (1-10) |
| `location_lat` | DECIMAL(10,8) | –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: —à–∏—Ä–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `location_lng` | DECIMAL(11,8) | –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: –¥–æ–ª–≥–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `location_name` | VARCHAR(255) | –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `likes_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ |
| `comments_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ |
| `views_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ |
| `reposts_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–æ—Å—Ç–æ–≤ |
| `mentions_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π |
| `is_repost` | BOOLEAN | –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–µ–ø–æ—Å—Ç–æ–º |
| `original_post_id` FK | UUID | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç (–µ—Å–ª–∏ —Ä–µ–ø–æ—Å—Ç) ‚Üí posts.id |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ—Å—Ç |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `author_id`
- INDEX –Ω–∞ `created_at` (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ª–µ–Ω—Ç—ã)
- INDEX –Ω–∞ `is_active`
- GIST –Ω–∞ geography column (–¥–ª—è –≥–µ–æ–ø–æ–∏—Å–∫–∞)
- INDEX –Ω–∞ `original_post_id`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –¢–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä–∞ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã (`users.is_master = TRUE`)
- –ú–∞–∫—Å–∏–º—É–º 10 –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –Ω–∞ –ø–æ—Å—Ç
- –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤
- –†–µ–ø–æ—Å—Ç –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º—è–Ω—É—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø–æ—Å—Ç–µ

---

### 11. post_media - –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –ø–æ—Å—Ç–æ–≤ (NEW) üÜï

–•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –¥–ª—è –ø–æ—Å—Ç–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `post_id` FK | UUID | –ü–æ—Å—Ç ‚Üí posts.id |
| `media_type` | ENUM | photo, video |
| `media_url` | TEXT | URL –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞ (S3/MinIO) |
| `thumbnail_url` | TEXT | URL –ø—Ä–µ–≤—å—é (–¥–ª—è –≤–∏–¥–µ–æ) |
| `width` | INTEGER | –®–∏—Ä–∏–Ω–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö |
| `height` | INTEGER | –í—ã—Å–æ—Ç–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö |
| `duration_sec` | INTEGER | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–ª—è –≤–∏–¥–µ–æ, —Å–µ–∫—É–Ω–¥—ã) |
| `file_size_kb` | INTEGER | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–ö–ë) |
| `sort_order` | INTEGER | –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (1-10) |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `post_id`
- INDEX –Ω–∞ `sort_order`

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å–∏–º—É–º 10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ –æ–¥–∏–Ω –ø–æ—Å—Ç
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–æ—Ç–æ: JPG, PNG, WEBP
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤–∏–¥–µ–æ: MP4, MOV
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ: 10 –ú–ë
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ: 100 –ú–ë
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ: 60 —Å–µ–∫—É–Ω–¥

---

### 12. post_mentions - –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (NEW) üÜï

–£–ø–æ–º–∏–Ω–∞–Ω–∏—è (@username) –≤ –ø–æ—Å—Ç–∞—Ö.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `post_id` FK | UUID | –ü–æ—Å—Ç ‚Üí posts.id |
| `mentioned_user_id` FK | UUID | –£–ø–æ–º—è–Ω—É—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí users.id |
| `author_id` FK | UUID | –ê–≤—Ç–æ—Ä –ø–æ—Å—Ç–∞ ‚Üí users.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `post_id`
- INDEX –Ω–∞ `mentioned_user_id`
- UNIQUE –Ω–∞ `(post_id, mentioned_user_id)` (–Ω–µ–ª—å–∑—è —É–ø–æ–º—è–Ω—É—Ç—å –¥–≤–∞–∂–¥—ã)

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ú–æ–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–º –º–∞—Å—Ç–µ—Ä –æ–∫–∞–∑—ã–≤–∞–ª —É—Å–ª—É–≥—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞: EXISTS (SELECT 1 FROM bookings WHERE master_id = author_id AND client_id = mentioned_user_id AND status = 'completed')
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

### 13. post_services - –°–≤—è–∑—å –ø–æ—Å—Ç–æ–≤ —Å —É—Å–ª—É–≥–∞–º–∏ (NEW) üÜï

–û—Ç–º–µ—Ç–∫–∞ —É—Å–ª—É–≥ –≤ –ø–æ—Å—Ç–∞—Ö.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `post_id` FK | UUID | –ü–æ—Å—Ç ‚Üí posts.id |
| `service_id` FK | UUID | –£—Å–ª—É–≥–∞ ‚Üí services.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–≤—è–∑–∏ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `post_id`
- INDEX –Ω–∞ `service_id`
- UNIQUE –Ω–∞ `(post_id, service_id)`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ú–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª—É–≥ –≤ –æ–¥–Ω–æ–º –ø–æ—Å—Ç–µ
- –¢–æ–ª—å–∫–æ —É—Å–ª—É–≥–∏, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –∞–≤—Ç–æ—Ä—É –ø–æ—Å—Ç–∞
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —É—Å–ª—É–≥—É –≤ –ø–æ—Å—Ç–µ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º —É—Å–ª—É–≥–∏

---

### 14. likes - –õ–∞–π–∫–∏ –Ω–∞ –ø–æ—Å—Ç–∞—Ö (NEW) üÜï

–õ–∞–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –ø–æ—Å—Ç–∞—Ö.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `post_id` FK | UUID | –ü–æ—Å—Ç ‚Üí posts.id |
| `user_id` FK | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí users.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –ª–∞–π–∫–∞ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `post_id`
- INDEX –Ω–∞ `user_id`
- UNIQUE –Ω–∞ `(post_id, user_id)` (–æ–¥–∏–Ω –ª–∞–π–∫ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- INDEX –Ω–∞ `created_at`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–∞–π–∫–∞ ‚Üí –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç `posts.likes_count`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–∞–π–∫–∞ ‚Üí –¥–µ–∫—Ä–µ–º–µ–Ω—Ç `posts.likes_count`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—É –ø–æ—Å—Ç–∞

---

### 15. comments - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º (NEW) üÜï

–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `post_id` FK | UUID | –ü–æ—Å—Ç ‚Üí posts.id |
| `user_id` FK | UUID | –ê–≤—Ç–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è ‚Üí users.id |
| `parent_comment_id` FK | UUID | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤) ‚Üí comments.id |
| `text` | TEXT | –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤) |
| `likes_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |
| `replies_count` | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ |
| `is_deleted` | BOOLEAN | –£–¥–∞–ª–µ–Ω –ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `post_id`
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `parent_comment_id`
- INDEX –Ω–∞ `created_at`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è ‚Üí –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç `posts.comments_count`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (1 —É—Ä–æ–≤–µ–Ω—å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—É –ø–æ—Å—Ç–∞
- –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

---

### 16. friendships - –î—Ä—É–∑—å—è (NEW) üÜï

–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥—Ä—É–∑—å—è–º–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` FK | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 ‚Üí users.id |
| `friend_id` FK | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2 ‚Üí users.id |
| `status` | ENUM | pending, accepted, rejected, blocked |
| `requested_by` FK | UUID | –ö—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å ‚Üí users.id |
| `requested_at` | TIMESTAMP | –î–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ |
| `accepted_at` | TIMESTAMP | –î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `friend_id`
- INDEX –Ω–∞ `status`
- UNIQUE –Ω–∞ `(user_id, friend_id)` –∏–ª–∏ `(friend_id, user_id)` (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–µ–π)

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –°—Ç–∞—Ç—É—Å—ã:
  - `pending` - –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  - `accepted` - –¥—Ä—É–∑—å—è
  - `rejected` - –æ—Ç–∫–ª–æ–Ω–µ–Ω
  - `blocked` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é
- –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ ‚Üí –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç `users.friends_count` –¥–ª—è –æ–±–æ–∏—Ö
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥—Ä—É–≥–∞ ‚Üí –¥–µ–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–æ–≤

---

### 17. subscriptions_users - –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (NEW) üÜï

–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ª—é–±—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `follower_id` FK | UUID | –ü–æ–¥–ø–∏—Å—á–∏–∫ ‚Üí users.id |
| `following_id` FK | UUID | –ù–∞ –∫–æ–≥–æ –ø–æ–¥–ø–∏—Å–∞–Ω ‚Üí users.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `follower_id`
- INDEX –Ω–∞ `following_id`
- UNIQUE –Ω–∞ `(follower_id, following_id)`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏:
  - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç `users.following_count` —É follower
  - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç `users.followers_count` —É following
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å
- –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –ª–µ–Ω—Ç–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞

---

### 18. reposts - –†–µ–ø–æ—Å—Ç—ã –ø–æ—Å—Ç–æ–≤ (NEW) üÜï

–†–µ–ø–æ—Å—Ç—ã –ø–æ—Å—Ç–æ–≤ –≤ —Å–≤–æ—é –ª–µ–Ω—Ç—É.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `original_post_id` FK | UUID | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç ‚Üí posts.id |
| `repost_id` FK | UUID | –ù–æ–≤—ã–π –ø–æ—Å—Ç (—Ä–µ–ø–æ—Å—Ç) ‚Üí posts.id |
| `user_id` FK | UUID | –ö—Ç–æ —Å–¥–µ–ª–∞–ª —Ä–µ–ø–æ—Å—Ç ‚Üí users.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Ä–µ–ø–æ—Å—Ç–∞ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `original_post_id`
- INDEX –Ω–∞ `user_id`
- UNIQUE –Ω–∞ `(original_post_id, user_id)` (–æ–¥–∏–Ω —Ä–µ–ø–æ—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –†–µ–ø–æ—Å—Ç –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º—è–Ω—É—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø–æ—Å—Ç–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞: EXISTS (SELECT 1 FROM post_mentions WHERE post_id = original_post_id AND mentioned_user_id = user_id)
- –ü—Ä–∏ —Ä–µ–ø–æ—Å—Ç–µ:
  - –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ `posts` —Å `is_repost = TRUE`
  - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç `posts.reposts_count` –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞

---

### 8. bookings - –ó–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–û–ë–ù–û–í–õ–ï–ù–û)

–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–µ–π —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ç–∑—ã–≤–∞–º–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `client_id` FK | UUID | –ö–ª–∏–µ–Ω—Ç ‚Üí users.id |
| `master_id` FK | UUID | –ú–∞—Å—Ç–µ—Ä ‚Üí users.id |
| `service_id` FK | UUID | –£—Å–ª—É–≥–∞ ‚Üí services.id |
| `start_time` | TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ |
| `end_time` | TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è |
| `duration_minutes` | INTEGER | –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω) |
| `price` | DECIMAL(10,2) | –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ |
| `status` | ENUM | pending, confirmed, in_progress, completed, cancelled |
| `comment` | TEXT | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞ |
| `cancellation_reason` | TEXT | –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã |
| `cancelled_by` FK | UUID | –ö—Ç–æ –æ—Ç–º–µ–Ω–∏–ª ‚Üí users.id |
| **`client_review_left`** üÜï | **BOOLEAN** | **–û—Å—Ç–∞–≤–∏–ª –ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–∑—ã–≤** |
| **`master_review_left`** üÜï | **BOOLEAN** | **–û—Å—Ç–∞–≤–∏–ª –ª–∏ –º–∞—Å—Ç–µ—Ä –æ—Ç–∑—ã–≤** |
| **`completed_at`** üÜï | **TIMESTAMP** | **–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `client_id`
- INDEX –Ω–∞ `master_id`
- INDEX –Ω–∞ `service_id`
- INDEX –Ω–∞ `status`
- INDEX –Ω–∞ `start_time`
- INDEX –Ω–∞ `(client_id, client_review_left)` üÜï (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤)

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ v2.0:**
- –°—Ç–∞—Ç—É—Å `completed` –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `master_review_left = TRUE`
- –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å, –µ—Å–ª–∏ EXISTS (SELECT 1 FROM bookings WHERE client_id = X AND status = 'completed' AND client_review_left = FALSE)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ—Ç–∑—ã–≤–µ

---

### 23. notifications - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–†–ê–°–®–ò–†–ï–ù–û)

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å 11 —Ç–∏–ø–∞–º–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` FK | UUID | –ü–æ–ª—É—á–∞—Ç–µ–ª—å ‚Üí users.id |
| `type` | ENUM | **11 —Ç–∏–ø–æ–≤** (—Å–º. –Ω–∏–∂–µ) |
| `title` | VARCHAR(255) | –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `message` | TEXT | –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `data` | JSONB | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `related_id` | UUID | ID —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ |
| `related_type` | VARCHAR(50) | –¢–∏–ø –æ–±—ä–µ–∫—Ç–∞ (booking, post, user, etc.) |
| `is_read` | BOOLEAN | –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏ |
| `is_push_sent` | BOOLEAN | –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –ª–∏ push |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (11):**

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–º—É | –ö–æ–≥–¥–∞ |
|-----|----------|------|-------|
| `booking_new` | –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å | –ú–∞—Å—Ç–µ—Ä—É | –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–ª –∑–∞–ø–∏—Å—å |
| `booking_confirmed` | –ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ | –ö–ª–∏–µ–Ω—Ç—É | –ú–∞—Å—Ç–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª |
| `booking_reminder` | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏ | –û–±–æ–∏–º | –ó–∞ X —á–∞—Å–æ–≤ –¥–æ –∑–∞–ø–∏—Å–∏ |
| `message_new` | –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | –ü–æ–ª—É—á–∞—Ç–µ–ª—é | –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ |
| `friend_request` | –ó–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è | –ü–æ–ª—É—á–∞—Ç–µ–ª—é | –ö—Ç–æ-—Ç–æ —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å |
| `friend_accepted` | –ü—Ä–∏–Ω—è—Ç –≤ –¥—Ä—É–∑—å—è | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é | –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω |
| `post_mention` | –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –ø–æ—Å—Ç–µ | –£–ø–æ–º—è–Ω—É—Ç–æ–º—É | @username –≤ –ø–æ—Å—Ç–µ |
| `post_like` | –ù–æ–≤—ã–π –ª–∞–π–∫ | –ê–≤—Ç–æ—Ä—É –ø–æ—Å—Ç–∞ | –ö—Ç–æ-—Ç–æ –ª–∞–π–∫–Ω—É–ª |
| `post_comment` | –ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π | –ê–≤—Ç–æ—Ä—É –ø–æ—Å—Ç–∞ | –ö—Ç–æ-—Ç–æ –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª |
| `user_subscribed` | –ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é | –ö—Ç–æ-—Ç–æ –ø–æ–¥–ø–∏—Å–∞–ª—Å—è |
| `booking_proposal` | –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ | –ö–ª–∏–µ–Ω—Ç—É | –ú–∞—Å—Ç–µ—Ä –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–ø–∏—Å—å |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `type`
- INDEX –Ω–∞ `is_read`
- INDEX –Ω–∞ `created_at`

**–ü–æ–ª–µ data (JSONB):**
–ü—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤:

```json
// booking_new
{
  "booking_id": "uuid",
  "client_name": "Ivan Petrov",
  "service_name": "–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞",
  "date": "2026-01-06T16:00:00Z"
}

// post_mention
{
  "post_id": "uuid",
  "author_id": "uuid",
  "author_name": "Anna Ivanova",
  "post_preview_url": "https://..."
}

// friend_request
{
  "from_user_id": "uuid",
  "from_user_name": "Maria Smirnova",
  "from_user_avatar": "https://..."
}
```

---

### 22. messages - –°–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö (–û–ë–ù–û–í–õ–ï–ù–û)

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —á–∞—Ç–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `chat_id` FK | UUID | –ß–∞—Ç ‚Üí chats.id |
| `sender_id` FK | UUID | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å ‚Üí users.id |
| `message_type` | ENUM | **text, photo, video, voice, location, profile_share, post_share, booking_proposal** üÜï |
| `text` | TEXT | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è text) |
| `media_url` | TEXT | URL –º–µ–¥–∏–∞ (–¥–ª—è photo/video/voice) |
| `metadata` | JSONB | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `is_read` | BOOLEAN | –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏ |
| `read_at` | TIMESTAMP | –î–∞—Ç–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏—è |
| `is_deleted` | BOOLEAN | –£–¥–∞–ª–µ–Ω–æ –ª–∏ |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ù–æ–≤—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π v2.0:**
- `profile_share` - –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–æ—Ñ–∏–ª–µ–º –º–∞—Å—Ç–µ—Ä–∞
- `post_share` - –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –ø–æ—Å—Ç–æ–º
- `booking_proposal` - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ—Ç –º–∞—Å—Ç–µ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–ª–∏ —Ä—É—á–Ω–æ–µ)

**–ü—Ä–∏–º–µ—Ä—ã metadata:**

```json
// booking_proposal
{
  "type": "booking_proposal",
  "service_id": "uuid",
  "service_name": "–ú–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º",
  "proposed_date": "2026-01-05T14:00:00Z",
  "price": 1500,
  "duration_minutes": 90,
  "is_auto": true  // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
}

// profile_share
{
  "type": "profile_share",
  "user_id": "uuid",
  "user_name": "Anna Ivanova",
  "user_avatar": "https://...",
  "is_master": true
}

// post_share
{
  "type": "post_share",
  "post_id": "uuid",
  "preview_url": "https://..."
}
```

---

### 25. auto_booking_settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (NEW) üÜï

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∑–∞–ø–∏—Å–µ–π (–ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è).

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `master_id` FK | UUID | –ú–∞—Å—Ç–µ—Ä ‚Üí users.id |
| `client_id` FK | UUID | –ö–ª–∏–µ–Ω—Ç ‚Üí users.id (NULL = –¥–ª—è –≤—Å–µ—Ö) |
| `service_id` FK | UUID | –£—Å–ª—É–≥–∞ ‚Üí services.id |
| `interval_days` | INTEGER | –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ –¥–Ω—è—Ö (7, 14, 21, 30) |
| `is_active` | BOOLEAN | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ |
| `last_sent_at` | TIMESTAMP | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ |
| `next_send_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `master_id`
- INDEX –Ω–∞ `client_id`
- INDEX –Ω–∞ `next_send_at` (–¥–ª—è cron jobs)
- INDEX –Ω–∞ `is_active`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –¢–æ–ª—å–∫–æ –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤ —Å –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–æ–π
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: `client_id = NULL`
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `client_id`
- Cron job –∫–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `next_send_at <= NOW() AND is_active = TRUE`
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏: `last_sent_at = NOW()`, `next_send_at = NOW() + interval_days`

---

### 26. user_settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (NEW) üÜï

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` FK | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí users.id |
| `auto_proposals_enabled` | BOOLEAN | –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (TRUE –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| `auto_proposals_blacklist` | UUID[] | –ú–∞—Å—Å–∏–≤ master_id, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–∫–ª—é—á–µ–Ω—ã –∞–≤—Ç–æ–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è |
| `push_enabled` | BOOLEAN | Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã |
| `email_notifications` | BOOLEAN | Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `notification_types` | JSONB | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `feed_filters` | JSONB | –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ª–µ–Ω—Ç—ã |
| `search_history` | TEXT[] | –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20) |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- UNIQUE –Ω–∞ `user_id`

**–ü—Ä–∏–º–µ—Ä notification_types:**
```json
{
  "booking_new": true,
  "booking_confirmed": true,
  "booking_reminder": true,
  "message_new": true,
  "friend_request": true,
  "friend_accepted": true,
  "post_mention": true,
  "post_like": false,  // –æ—Ç–∫–ª—é—á–µ–Ω—ã
  "post_comment": true,
  "user_subscribed": true,
  "booking_proposal": true
}
```

**–ü—Ä–∏–º–µ—Ä feed_filters:**
```json
{
  "radius_km": 20,
  "categories": ["beauty", "repair"],
  "show_friends_only": false,
  "show_subscriptions_only": false,
  "show_favorites_only": false
}
```

---

### 28. favorites_posts - –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã (NEW) üÜï

–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` FK | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí users.id |
| `post_id` FK | UUID | –ü–æ—Å—Ç ‚Üí posts.id |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `post_id`
- UNIQUE –Ω–∞ `(user_id, post_id)`

---

### 29. geolocation_history - –ò—Å—Ç–æ—Ä–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (NEW) üÜï

–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` PK | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_id` FK | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí users.id |
| `latitude` | DECIMAL(10,8) | –®–∏—Ä–æ—Ç–∞ |
| `longitude` | DECIMAL(11,8) | –î–æ–ª–≥–æ—Ç–∞ |
| `accuracy_meters` | INTEGER | –¢–æ—á–Ω–æ—Å—Ç—å (–º–µ—Ç—Ä—ã) |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- INDEX –Ω–∞ `user_id`
- INDEX –Ω–∞ `created_at`
- GIST –Ω–∞ geography column

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–º–∏–Ω–∏–º—É–º 100–º –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –•—Ä–∞–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

---

## üìä ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    users    ‚îÇ‚îÄ‚îÄ‚îê
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
       ‚îÇ         ‚îÇ
       ‚îÇ is_master? YES
       ‚îÇ         ‚îÇ
       ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇmaster_prof. ‚îÇ  ‚îÇ      posts       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚Üí post_media
       ‚îÇ                  ‚îú‚îÄ‚Üí post_mentions
       ‚îÇ                  ‚îú‚îÄ‚Üí post_services
       ‚îÇ                  ‚îú‚îÄ‚Üí likes
       ‚îÇ                  ‚îú‚îÄ‚Üí comments
       ‚îÇ                  ‚îî‚îÄ‚Üí reposts
       ‚îÇ
       ‚îú‚îÄ‚Üí services
       ‚îú‚îÄ‚Üí schedule_slots
       ‚îú‚îÄ‚Üí bookings
       ‚îî‚îÄ‚Üí reviews

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    users    ‚îÇ‚îÄ‚îÄ‚îê
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
       ‚îÇ         ‚îÇ
       ‚îÇ         ‚îÇ
       ‚îú‚îÄ‚Üí friendships (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ)
       ‚îú‚îÄ‚Üí subscriptions_users (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ)
       ‚îú‚îÄ‚Üí chats ‚Üí messages
       ‚îú‚îÄ‚Üí notifications
       ‚îú‚îÄ‚Üí user_settings
       ‚îú‚îÄ‚Üí favorites_masters
       ‚îú‚îÄ‚Üí favorites_posts
       ‚îî‚îÄ‚Üí geolocation_history
```

---

## üîç –ö–ª—é—á–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã v2.0

### 1. –õ–µ–Ω—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (Feed) –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

```sql
WITH user_location AS (
  SELECT last_location_lat, last_location_lng
  FROM users
  WHERE id = :current_user_id
),
nearby_posts AS (
  SELECT p.*,
         u.first_name || ' ' || u.last_name AS author_name,
         u.avatar_url AS author_avatar,
         mp.base_address,
         ST_Distance(
           ST_MakePoint(p.location_lng, p.location_lat)::geography,
           ST_MakePoint(ul.last_location_lng, ul.last_location_lat)::geography
         ) / 1000 AS distance_km
  FROM posts p
  JOIN users u ON p.author_id = u.id
  JOIN master_profiles mp ON u.id = mp.user_id
  CROSS JOIN user_location ul
  WHERE p.is_active = TRUE
    AND u.is_master = TRUE
    AND ST_DWithin(
      ST_MakePoint(p.location_lng, p.location_lat)::geography,
      ST_MakePoint(ul.last_location_lng, ul.last_location_lat)::geography,
      :radius_meters -- 20000 –¥–ª—è 20–∫–º
    )
  ORDER BY p.created_at DESC
  LIMIT 50
)
SELECT np.*,
       COALESCE(pm.media_urls, '[]'::json) AS media
FROM nearby_posts np
LEFT JOIN LATERAL (
  SELECT json_agg(json_build_object(
    'url', media_url,
    'type', media_type,
    'thumbnail', thumbnail_url
  ) ORDER BY sort_order) AS media_urls
  FROM post_media
  WHERE post_id = np.id
) pm ON true;
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±–µ–∑ –æ—Ç–∑—ã–≤–∞?
SELECT COUNT(*) AS pending_reviews
FROM bookings
WHERE client_id = :current_user_id
  AND status = 'completed'
  AND client_review_left = FALSE;

-- –ï—Å–ª–∏ pending_reviews > 0, —Ç–æ –±–ª–æ–∫–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
```

### 3. –î—Ä—É–∑—å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
SELECT u.id, u.first_name, u.last_name, u.avatar_url,
       u.is_master, u.rating, u.reviews_count
FROM friendships f
JOIN users u ON (
  CASE
    WHEN f.user_id = :current_user_id THEN f.friend_id
    ELSE f.user_id
  END
) = u.id
WHERE (f.user_id = :current_user_id OR f.friend_id = :current_user_id)
  AND f.status = 'accepted'
ORDER BY u.first_name, u.last_name;
```

### 4. –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏

```sql
-- –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ (–∫—Ç–æ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –º–µ–Ω—è)
SELECT u.id, u.first_name, u.last_name, u.avatar_url
FROM subscriptions_users su
JOIN users u ON su.follower_id = u.id
WHERE su.following_id = :current_user_id
ORDER BY su.created_at DESC;

-- –ü–æ–¥–ø–∏—Å–∫–∏ (–Ω–∞ –∫–æ–≥–æ —è –ø–æ–¥–ø–∏—Å–∞–Ω)
SELECT u.id, u.first_name, u.last_name, u.avatar_url, u.is_master
FROM subscriptions_users su
JOIN users u ON su.following_id = u.id
WHERE su.follower_id = :current_user_id
ORDER BY su.created_at DESC;
```

### 5. –ú–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞—Ç—å —Ä–µ–ø–æ—Å—Ç?

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–ø–æ–º—è–Ω—É—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø–æ—Å—Ç–µ?
SELECT EXISTS (
  SELECT 1
  FROM post_mentions
  WHERE post_id = :post_id
    AND mentioned_user_id = :current_user_id
) AS can_repost;
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü (–ø—Ä–∏–º–µ—Ä–Ω–∞—è)

| –¢–∞–±–ª–∏—Ü–∞ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä (1 –≥–æ–¥) | –†–æ—Å—Ç |
|---------|-------------------------|------|
| `users` | 100K –∑–∞–ø–∏—Å–µ–π | –õ–∏–Ω–µ–π–Ω—ã–π |
| `posts` | 500K –∑–∞–ø–∏—Å–µ–π | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π |
| `post_media` | 2M –∑–∞–ø–∏—Å–µ–π | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π |
| `likes` | 5M –∑–∞–ø–∏—Å–µ–π | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π |
| `comments` | 1M –∑–∞–ø–∏—Å–µ–π | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π |
| `friendships` | 200K –∑–∞–ø–∏—Å–µ–π | –õ–∏–Ω–µ–π–Ω—ã–π |
| `subscriptions_users` | 500K –∑–∞–ø–∏—Å–µ–π | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π |
| `messages` | 2M –∑–∞–ø–∏—Å–µ–π | –õ–∏–Ω–µ–π–Ω—ã–π |
| `notifications` | 10M –∑–∞–ø–∏—Å–µ–π | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π |
| `bookings` | 300K –∑–∞–ø–∏—Å–µ–π | –õ–∏–Ω–µ–π–Ω—ã–π |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ü–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ `notifications` –ø–æ –º–µ—Å—è—Ü–∞–º
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ—Å—Ç–æ–≤ (> 1 –≥–æ–¥–∞)
- CDN –¥–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis) –¥–ª—è –ª–µ–Ω—Ç—ã –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

---

## ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ v2.0

### –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users

```sql
ALTER TABLE users
  ADD COLUMN is_master BOOLEAN DEFAULT FALSE,
  ADD COLUMN master_profile_completed BOOLEAN DEFAULT FALSE,
  ADD COLUMN posts_count INTEGER DEFAULT 0,
  ADD COLUMN friends_count INTEGER DEFAULT 0,
  ADD COLUMN followers_count INTEGER DEFAULT 0,
  ADD COLUMN following_count INTEGER DEFAULT 0;

CREATE INDEX idx_users_is_master ON users(is_master);
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã bookings

```sql
ALTER TABLE bookings
  ADD COLUMN client_review_left BOOLEAN DEFAULT FALSE,
  ADD COLUMN master_review_left BOOLEAN DEFAULT FALSE,
  ADD COLUMN completed_at TIMESTAMP;

CREATE INDEX idx_bookings_review_check ON bookings(client_id, client_review_left);
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü

```sql
-- –°–º. –ø–æ–¥—Ä–æ–±–Ω—ã–µ CREATE TABLE –≤—ã—à–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
```

---

**–í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã:** 2.0
**–î–∞—Ç–∞:** 24 –¥–µ–∫–∞–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä:** Claude AI
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
